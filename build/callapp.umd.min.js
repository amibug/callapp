!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.callapp=t()}(this,function(){"use strict";const e={};e.getHash=(e=>{const t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!==n?unescape(n[2]):null}),e.isAllowDomains=function(e,t){var n,o,i=0;if(!e)return!1;for(;i<t.length;i++)t[i]="("+t[i].replace(".","\\.")+")";n="("+t.join("|")+")";const r=new RegExp("^((http://)|(https://)|(//))?([0-9a-zA-Z\\._:\\-]*[\\.@])?"+n+"(:[0-9]+)?(/.*)?$");return!(!(o=e.match(r))||!o[0])},e.insertParam=function(e,t){if("object"==typeof t){return Object.keys(t).forEach((n,o)=>{t[n]&&(e+=(e.split("?")[1]?"&":"?")+n+"="+t[n])}),e}if("string"==typeof t)return e+=(e.split("?")[1]?"&":"?")+t},e.getHashWithOutUnescape=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!==n?n[2]:null},e.dateFormat=((e,t)=>{e=e?parseInt(e):(new Date).getTime(),t=t||"yyyy-MM-dd hh:mm:ss";const n=new Date(e),o={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};for(var i in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?o[i]:("00"+o[i]).substr((""+o[i]).length)));return t}),e.browser=(()=>{const e=navigator.userAgent;navigator.appVersion;return{mobile:!!e.match(/AppleWebKit.*Mobile.*/)||!!e.match(/AppleWebKit/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1}})(),e.clone=(e=>{if("object"==typeof e)return JSON.parse(JSON.stringify(e));console.log("非对象")}),e.addHandler=((e,t,n)=>{e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n});!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}("#DebugPop {\n  position: fixed;\n  right: 0;\n  bottom: 0;\n  width: 4.5rem;\n  height: 7rem;\n}\n#DebugPop #DebugPopbox {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow-x: hidden;\n  overflow-y: auto;\n  border-radius: 0.1rem;\n  background: rgba(0, 0, 0, 0.5);\n  color: #fff;\n}\n#DebugPop #DebugPopbox ul {\n  width: 100%;\n  height: 100%;\n}\n#DebugPop #DebugPopbox ul li {\n  line-height: 0.3rem;\n  border-bottom: 1px dotted rgba(255, 255, 255, 0.6);\n  background: rgba(0, 0, 0, 0.5);\n  color: rgba(255, 255, 255, 0.9);\n  text-align: left;\n  padding: 0.1rem 0.05rem;\n  word-break: break-all;\n}\n#DebugPop #DebugPopbox ul li:last-child {\n  border-bottom: none;\n}\n#DebugPop .debug-button {\n  position: absolute;\n  z-index: 1000;\n  right: 0;\n  height: 0.4rem;\n  line-height: 0.4rem;\n  width: 0.8rem;\n  top: -0.43rem;\n  color: rgba(255, 255, 255, 0.8);\n  border-radius: 0.1rem;\n  background: transparent;\n  border: 1px solid rgba(0, 0, 0, 0.5);\n  background: rgba(0, 0, 0, 0.4);\n  cursor: pointer;\n}\n#DebugPop .debug-button:active {\n  color: rgba(255, 255, 255, 0.6);\n  background: rgba(0, 0, 0, 0.6);\n}\n#DebugPop #DebugPopboxClear {\n  right: 0.9rem;\n}\n");const t=()=>'\n      <div id="DebugPop">\n        <div id="DebugPopbox">\n          <ul id="DebugPopboxContent">\n          </ul>\n        </div>\n        <button id="DebugPopboxClear" class="debug-button">清屏</button>\n        <button id="DebugPopboxClose" class="debug-button">关闭</button>\n      </div>\n    ',n=e=>`\n      <li>${e}</li>\n    `;let o={log:function(){const o=window.Zepto;if(!o)return void console.log("Zepto is undefined");if(console.log(arguments),!e.getHash("debug"))return;document.querySelector("#DebugPop")||o("body").append(t());const i=e=>{let t="";return null==e&&(t=e),(t="function"==typeof e||"number"==typeof e?e.toString():JSON.stringify(e))+""};let r="";for(let e=0;e<arguments.length;e++)r+=i(arguments[e])+",";r=r.substr(0,r.length-1);try{o("#DebugPopboxContent").append(n(r))}catch(e){console.log("log error",JSON.stringify(e))}o("#DebugPopboxClear").on("click",()=>{o("#DebugPopboxContent").html("")}),o("#DebugPopboxClose").on("click",()=>{o("#DebugPop").remove()})}};window.debug=o;const i={};let r="";r=e.getHash("debug")&&e.getHash("ua")?e.getHash("ua"):window.navigator.userAgent;let a=!1,s=!1,l="",c=r.match(/Android[\s\/]([\d\.]+)/);function d(e,t){const n=e.split("."),o=t.split(".");for(let e=0;e<n.length||e<o.length;e+=1){const t=parseInt(n[e],10)||0,i=parseInt(o[e],10)||0;if(t<i)return-1;if(t>i)return 1}return 0}c?(a=!0,l=c[1]):r.match(/(iPhone|iPad|iPod)/)&&(s=!0,(c=r.match(/OS ([\d_\.]+) like Mac OS X/))&&(l=c[1].split("_").join(".")));let u=!1,g=!1,p=!1;r.match(/(?:Chrome|CriOS)\/([\d\.]+)/)?(u=!0,r.match(/Version\/[\d+\.]+\s*Chrome/)&&(p=!0)):r.match(/iPhone|iPad|iPod/)&&(r.match(/Safari/)&&r.match(/Version\/([\d\.]+)/)?g=!0:r.match(/OS ([\d_\.]+) like Mac OS X/)&&(p=!0));const b=window.document;let h;return i.gotoPage=function(e,t,n){let i=e;o.log("targetUrl",e);const c=a&&u&&!p,f=a&&!!r.match(/samsung/i)&&d(l,"4.3")>=0&&d(l,"4.5")<0,m=s&&d(l,"9.0")>=0&&g;if(o.log("isOriginalChrome",c),o.log("fixUgly",f),o.log("ios9SafariFix",m),o.log("forceIntent",n),c||n){const e=`#Intent;scheme=${i.substring(0,i.indexOf("://"))};package=${t};end`;i=i.replace(/.*?\:\/\//,"intent://"),i+=e,o.log("Intent",i)}if(m){if(/^(http|https)\:\/\//.test(i))return window.Tracker&&window.Tracker.click&&window.Tracker.click("not_schema"),void console.log("not schema");setTimeout(()=>{!function(e){const t=b.createElement("a");t.setAttribute("href",e),t.style.display="none",b.body.appendChild(t);const n=b.createEvent("HTMLEvents");n.initEvent("click",!1,!1),t.dispatchEvent(n)}(i)},100)}else if(0===i.indexOf("intent:"))o.log("jump intent"),setTimeout(()=>{window.location.href=i},100);else{/^(http(s)?\:|javascript\:|vbscript\:|file\:|data\:|sms\:|smsto\:|tel\:|mailto\:|aliim\:|dingtalk\:|weixin\:)/.test(i.toLocaleLowerCase())?o.log("schema is url"):(o.log("call in iframe"),function(e){o.log("in iframe func",e),h||(o.log("create iframe"),(h=b.createElement("iframe")).id=`callapp_iframe_${Date.now()}`,h.frameborder="0",h.style.cssText="display:none;border:0;width:0;height:0;",b.body.appendChild(h)),h.src=e}(i))}},i});
